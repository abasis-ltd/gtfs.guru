# Core Validator (gtfs_validator_core)

## Scope

- Parses GTFS inputs (zip or directory), builds a `GtfsFeed`, runs validation rules, and emits notices.
- Produces report-ready data via `gtfs_validator_report` (JSON, HTML, SARIF).

## Key Paths

- Input and parsing: `crates/gtfs_validator_core/src/input.rs`, `csv_reader.rs`, `feed.rs`.
- Orchestration: `crates/gtfs_validator_core/src/engine.rs`, `validator.rs`.
- Rules: `crates/gtfs_validator_core/src/rules/` and registration in `rules/mod.rs`.
- Notices and schema: `crates/gtfs_validator_core/src/notice.rs`, `notice_schema.rs`, `build.rs`.
- Shared model types: `crates/gtfs_model/`.

## Validation Flow

1. Build a `GtfsInput` from a path or bytes.
2. `engine::validate_input` loads `GtfsFeed` and collects input notices.
3. `ValidatorRunner` runs each rule and merges `NoticeContainer` output.
4. Reports are generated via `gtfs_validator_report`.

## Adding or Updating a Rule

- Create a new module in `crates/gtfs_validator_core/src/rules/` and implement the `Validator` trait.
- Register the rule in `crates/gtfs_validator_core/src/rules/mod.rs` using `default_runner()`.
- Add unit tests next to the rule and integration tests in `crates/gtfs_validator_core/tests/`.
- Notice schemas are generated by `crates/gtfs_validator_core/build.rs`; ensure notice codes and fields are defined in the rule code so they are picked up.

## Performance Notes

- Parallel execution is behind the `parallel` feature; WASM builds disable it.
- Validators log `[PERF]` lines when a single rule takes unusually long.
